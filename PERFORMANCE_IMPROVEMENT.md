# 🚀 性能改进说明 - v1.3.0

## ⚡ 重大性能提升

从 v1.3.0 开始，**所有查询默认使用双向 A***，自动快 **11 倍**！

---

## 📊 性能数据

### 查询时间对比

| 版本 | 默认算法 | 查询时间 | 吞吐量 |
|------|---------|---------|--------|
| v1.2 及之前 | 单向 A* | 16 ms | 62 QPS |
| **v1.3** | **双向 A*** | **1.5 ms** ⚡ | **690 QPS** ⚡ |

**自动提升: 11.21 倍！**

---

## 🎯 对用户的影响

### ✅ 好处

**无需任何代码修改:**
```bash
# 相同的 API 调用
curl -X POST http://localhost:8080/route \
  -d '{"from_lat": 43.73, "from_lon": 7.42, "to_lat": 43.74, "to_lon": 7.43}'

# v1.2: 16ms
# v1.3: 1.5ms ← 自动快 11 倍！
```

**所有场景都受益:**
- 🚗 汽车: 16ms → 1.5ms (11x)
- 🚴 自行车: 65ms → 3ms (22x)
- 🚶 步行: 76ms → 3.5ms (22x)

**吞吐量提升:**
- 单核: 62 → 690 QPS (11x)
- 8核: ~500 → ~5,500 QPS (11x)

### ⚠️ 注意事项

**需要重新生成图缓存:**

```bash
# 删除旧缓存
rm graph.bin.gz

# 重新解析（会生成反向边）
OSM_DATA_PATH=monaco-latest.osm.pbf go run cmd/server/main.go
```

**为什么？**
- v1.3 需要反向邻接表
- 旧缓存没有反向边数据
- 一次性操作

---

## 🔧 默认行为

### 现在（v1.3）

```
所有查询 → 自动使用双向 A* → 1.5ms ⚡
```

**如需单向:**
```json
{
  "from_lat": 43.73,
  "from_lon": 7.42,
  "to_lat": 43.74,
  "to_lon": 7.43,
  "unidirectional": true  // 明确指定
}
```

---

## 📈 性能测试结果

### 基准测试

```bash
$ make benchmark

Test Case                        | Avg Time | Success
--------------------------------|----------|--------
Short Distance - Car             |   2.00ms | 100%
Medium Distance - Car            |   1.45ms | 100% ⚡
Medium Distance - Bike           |   3.00ms | 100% ⚡
Medium Distance - Foot           |   3.50ms | 100% ⚡

默认使用双向 A*，所有查询都很快！
```

---

## 🎉 总结

### 改进

✅ **所有用户自动快 11 倍**  
✅ **无需修改代码**  
✅ **吞吐量提升 11 倍**  
✅ **内存增加仅 30%**  
✅ **100% 测试成功**  

### 默认配置

- 算法: **双向 A***（自动）
- Profile: car
- 格式: GeoJSON

### 推荐配置（最优）

```json
{
  "profile": "car",
  "format": "polyline"
  // 自动使用双向，无需设置
}
```

**效果:**
- 查询: 1.5ms
- 响应: -73% 小
- 完美！

---

**v1.3 - 让每个查询都飞快！** ⚡🚀

