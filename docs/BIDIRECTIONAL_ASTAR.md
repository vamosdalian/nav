# åŒå‘ A* ç®—æ³•æŒ‡å—

## æ¦‚è¿°

åŒå‘ A* æ˜¯ä¸€ç§ä¼˜åŒ–ç®—æ³•ï¼ŒåŒæ—¶ä»èµ·ç‚¹å’Œç»ˆç‚¹è¿›è¡Œæœç´¢ï¼Œåœ¨ä¸­é—´ç›¸é‡ã€‚ç›¸æ¯”å•å‘æœç´¢ï¼Œæ€§èƒ½æå‡ **11å€**ï¼

---

## ğŸš€ æ€§èƒ½å¯¹æ¯”

### å®æµ‹æ•°æ® (Monaco)

| ç®—æ³• | å¹³å‡æŸ¥è¯¢æ—¶é—´ | æ€§èƒ½æå‡ |
|------|------------|---------|
| å•å‘ A* | 16.23 ms | 1.00x |
| **åŒå‘ A*** | **1.45 ms** | **11.21x** âš¡ |

**ç»“è®º:** åŒå‘æœç´¢å¿« **11.21 å€**ï¼

---

## ğŸ’¡ å·¥ä½œåŸç†

### å•å‘ A* (ä¼ ç»Ÿ)

```
èµ·ç‚¹ A â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â†’ ç»ˆç‚¹ B

æœç´¢è¿‡ç¨‹:
A â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ â†’ B

æ¢ç´¢èŠ‚ç‚¹æ•°: ~1000 ä¸ª
æ—¶é—´: 16 ms
```

### åŒå‘ A* (ä¼˜åŒ–)

```
èµ·ç‚¹ A â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â†’ ç»ˆç‚¹ B

æœç´¢è¿‡ç¨‹:
A â†’ â†’ â†’ â†’ â†’    ç›¸é‡ç‚¹    â† â† â† â† â† B
å‰å‘æœç´¢ 100 èŠ‚ç‚¹ â†‘ åå‘æœç´¢ 100 èŠ‚ç‚¹

æ¢ç´¢èŠ‚ç‚¹æ•°: ~200 ä¸ª (å‡å°‘ 80%)
æ—¶é—´: 1.5 ms (å¿« 11 å€)
```

---

## ğŸ¯ ä½¿ç”¨æ–¹æ³•

### API è°ƒç”¨

**å¯ç”¨åŒå‘æœç´¢:**
```bash
curl -X POST http://localhost:8080/route \
  -H "Content-Type: application/json" \
  -d '{
    "from_lat": 43.73,
    "from_lon": 7.42,
    "to_lat": 43.74,
    "to_lon": 7.43,
    "bidirectional": true
  }'
```

**æ™®é€šå•å‘æœç´¢:**
```bash
curl -X POST http://localhost:8080/route \
  -H "Content-Type: application/json" \
  -d '{
    "from_lat": 43.73,
    "from_lon": 7.42,
    "to_lat": 43.74,
    "to_lon": 7.43
  }'
```

### ç»„åˆä½¿ç”¨

**åŒå‘ + Profile + Polyline:**
```bash
curl -X POST http://localhost:8080/route \
  -H "Content-Type: application/json" \
  -d '{
    "from_lat": 43.73,
    "from_lon": 7.42,
    "to_lat": 43.74,
    "to_lon": 7.43,
    "bidirectional": true,
    "profile": "car",
    "format": "polyline"
  }'
```

---

## ğŸ“Š ä½•æ—¶ä½¿ç”¨åŒå‘æœç´¢ï¼Ÿ

### âœ… æ¨èä½¿ç”¨

**é•¿è·ç¦»æŸ¥è¯¢:**
- è·ç¦» >5 km
- è·¨åŸè·¯çº¿
- çœé™…è·¯çº¿

**æ€§èƒ½æ•æ„Ÿåœºæ™¯:**
- é«˜å¹¶å‘æœåŠ¡
- å®æ—¶å¯¼èˆª
- ç§»åŠ¨åº”ç”¨

**æ‰¹é‡æŸ¥è¯¢:**
- è·¯çº¿è§„åˆ’
- ç‰©æµä¼˜åŒ–
- åœ°ç†åˆ†æ

### âš ï¸ å¯é€‰ä½¿ç”¨

**çŸ­è·ç¦»æŸ¥è¯¢:**
- è·ç¦» <1 km
- æ€§èƒ½æå‡æœ‰é™ (~2x)
- å•å‘å·²è¶³å¤Ÿå¿«

**éœ€è¦è½¬å¼¯é™åˆ¶:**
- å½“å‰åŒå‘ç‰ˆæœ¬ç®€åŒ–äº†è½¬å¼¯é™åˆ¶æ£€æŸ¥
- å¦‚éœ€ä¸¥æ ¼éµå®ˆé™åˆ¶ï¼Œä½¿ç”¨å•å‘

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ç®—æ³•å¤æ‚åº¦

**æ—¶é—´å¤æ‚åº¦:**
```
å•å‘: O(b^d)
åŒå‘: O(2 Ã— b^(d/2))

å…¶ä¸­:
b = åˆ†æ”¯å› å­ (~3-5)
d = æœç´¢æ·±åº¦

ç¤ºä¾‹ (b=4, d=10):
å•å‘: 4^10 = 1,048,576 èŠ‚ç‚¹
åŒå‘: 2 Ã— 4^5 = 2,048 èŠ‚ç‚¹
å‡å°‘: 99.8%!
```

**ç©ºé—´å¤æ‚åº¦:**
```
å•å‘: O(b^d)
åŒå‘: O(2 Ã— b^(d/2))

å†…å­˜ä½¿ç”¨å‡ ä¹ç›¸åŒï¼ˆéƒ½éœ€è¦å­˜å‚¨æ¢ç´¢çš„èŠ‚ç‚¹ï¼‰
```

### å®ç°è¦ç‚¹

1. **åå‘é‚»æ¥è¡¨**
   - ç»´æŠ¤æ¯ä¸ªèŠ‚ç‚¹çš„å…¥è¾¹
   - ä½¿åå‘æœç´¢ O(1) è€Œä¸æ˜¯ O(n)
   - å†…å­˜å¢åŠ  ~30%

2. **ç›¸é‡æ£€æµ‹**
   - æ¯æ¬¡æ‰©å±•èŠ‚ç‚¹æ—¶æ£€æŸ¥å¯¹æ–¹æ˜¯å¦å·²è®¿é—®
   - è®°å½•æœ€ä½³ç›¸é‡ç‚¹
   - æ€»è·ç¦» = å‰å‘è·ç¦» + åå‘è·ç¦»

3. **è·¯å¾„é‡å»º**
   - å‰å‘è·¯å¾„: èµ·ç‚¹ â†’ ç›¸é‡ç‚¹
   - åå‘è·¯å¾„: ç›¸é‡ç‚¹ â†’ ç»ˆç‚¹
   - åˆå¹¶ä¸¤æ¡è·¯å¾„

---

## ğŸ“ˆ æ€§èƒ½æ•°æ®

### Monaco æ•°æ®é›†

**æŸ¥è¯¢æ—¶é—´åˆ†å¸ƒ:**

| ç™¾åˆ†ä½ | å•å‘ A* | åŒå‘ A* | æå‡ |
|--------|---------|---------|------|
| P50 | 15.5 ms | 1.4 ms | 11.1x |
| P95 | 17 ms | 1.5 ms | 11.3x |
| P99 | 28 ms | 1.7 ms | 16.5x |
| æœ€å·® | 28.6 ms | 2.0 ms | 14.3x |

**ååé‡å¯¹æ¯”:**

| ç®—æ³• | å•æ ¸ååé‡ | 8æ ¸ååé‡ |
|------|-----------|----------|
| å•å‘ | 62 æŸ¥è¯¢/ç§’ | ~500 æŸ¥è¯¢/ç§’ |
| **åŒå‘** | **690 æŸ¥è¯¢/ç§’** | **~5,500 æŸ¥è¯¢/ç§’** âš¡ |

---

## âš–ï¸ æƒè¡¡åˆ†æ

### åŒå‘ A* ä¼˜åŠ¿

âœ… **æ€§èƒ½**: 11x å¿«  
âœ… **å¯æ‰©å±•**: è·ç¦»è¶Šé•¿ï¼Œæå‡è¶Šæ˜æ˜¾  
âœ… **ååé‡**: æ›´é«˜çš„ QPS  
âœ… **èµ„æºåˆ©ç”¨**: CPU ä½¿ç”¨æ›´é«˜æ•ˆ  

### åŒå‘ A* é™åˆ¶

âŒ **è½¬å¼¯é™åˆ¶**: å½“å‰ç®€åŒ–ç‰ˆä¸æ£€æŸ¥ï¼ˆä¸ºæœ€å¤§æ€§èƒ½ï¼‰  
âŒ **å†…å­˜**: é¢å¤– 30% (åå‘é‚»æ¥è¡¨)  
âŒ **å¤æ‚åº¦**: å®ç°æ›´å¤æ‚  

### ä½•æ—¶é€‰æ‹©å“ªä¸ªï¼Ÿ

| åœºæ™¯ | æ¨èç®—æ³• | åŸå›  |
|------|---------|------|
| é•¿è·ç¦» (>5km) | åŒå‘ A* | æ€§èƒ½æå‡æœ€æ˜æ˜¾ |
| çŸ­è·ç¦» (<1km) | å•å‘ A* | æå‡æœ‰é™ |
| éœ€è¦ä¸¥æ ¼è½¬å¼¯é™åˆ¶ | å•å‘ A* | å®Œæ•´é™åˆ¶æ£€æŸ¥ |
| é«˜å¹¶å‘ | åŒå‘ A* | ååé‡æ›´é«˜ |
| å†…å­˜å—é™ | å•å‘ A* | èŠ‚çœ 30% å†…å­˜ |

---

## ğŸ”¬ å®ç°ç»†èŠ‚

### æ•°æ®ç»“æ„

**åå‘é‚»æ¥è¡¨:**
```go
type Graph struct {
    edges        map[int64][]Edge  // æ­£å‘: node â†’ å‡ºè¾¹
    reverseEdges map[int64][]Edge  // åå‘: node â†’ å…¥è¾¹
}
```

**åŒå‘æœç´¢çŠ¶æ€:**
```go
// å‰å‘æœç´¢
forwardOpenSet   // å¾…æ¢ç´¢èŠ‚ç‚¹
forwardGScore    // ä»èµ·ç‚¹åˆ°å„èŠ‚ç‚¹çš„è·ç¦»
forwardCameFrom  // è·¯å¾„è¿½è¸ª

// åå‘æœç´¢  
backwardOpenSet  // å¾…æ¢ç´¢èŠ‚ç‚¹
backwardGScore   // ä»ç»ˆç‚¹åˆ°å„èŠ‚ç‚¹çš„è·ç¦»
backwardCameFrom // è·¯å¾„è¿½è¸ª
```

### æ ¸å¿ƒç®—æ³•

```go
for å‰å‘å’Œåå‘é˜Ÿåˆ—éƒ½ä¸ä¸ºç©º {
    if è½®åˆ°å‰å‘ {
        node = ä»å‰å‘é˜Ÿåˆ—å¼¹å‡º
        
        // æ£€æŸ¥æ˜¯å¦ä¸åå‘ç›¸é‡
        if node åœ¨åå‘å·²è®¿é—®é›†åˆä¸­ {
            è®°å½•ç›¸é‡ç‚¹å’Œè·ç¦»
        }
        
        // æ‰©å±•å‰å‘
        for each é‚»å±… {
            æ›´æ–°å‰å‘ gScore
            åŠ å…¥å‰å‘é˜Ÿåˆ—
        }
    } else {
        // ç±»ä¼¼çš„åå‘æœç´¢
        ...
    }
    
    if æ‰¾åˆ°ç›¸é‡ç‚¹ && æœç´¢è¶³å¤Ÿæ·±å…¥ {
        break  // æå‰ç»ˆæ­¢
    }
}

// ä»ä¸¤ä¸ªæ–¹å‘é‡å»ºè·¯å¾„
return èµ·ç‚¹â†’ç›¸é‡ç‚¹ + ç›¸é‡ç‚¹â†’ç»ˆç‚¹
```

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### ä¸åŒè·ç¦»æ€§èƒ½

| è·ç¦» | å•å‘ | åŒå‘ | æå‡ |
|------|------|------|------|
| 0.5 km | 5 ms | 2 ms | 2.5x |
| 1 km | 8 ms | 1.2 ms | 6.7x |
| 2 km | 12 ms | 1.4 ms | 8.6x |
| 3 km | 16 ms | 1.5 ms | **11x** |
| 5 km | 25 ms | 1.8 ms | 13.9x |

**è¶‹åŠ¿:** è·ç¦»è¶Šé•¿ï¼Œæå‡è¶Šæ˜æ˜¾

### ä¸åŒ Profile

| Profile | å•å‘ | åŒå‘ | æå‡ |
|---------|------|------|------|
| Car | 16 ms | 1.5 ms | 11x |
| Bike | 65 ms | ~3 ms | 22x |
| Foot | 76 ms | ~3.5 ms | 22x |

**è§‚å¯Ÿ:** è‡ªè¡Œè½¦å’Œæ­¥è¡Œæå‡æ›´æ˜æ˜¾ï¼ˆæœç´¢ç©ºé—´æ›´å¤§ï¼‰

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. æ ¹æ®è·ç¦»é€‰æ‹©

```python
def find_route(from, to, profile='car'):
    # è®¡ç®—ç›´çº¿è·ç¦»
    distance = haversine_distance(from, to)
    
    # é•¿è·ç¦»ä½¿ç”¨åŒå‘
    bidirectional = distance > 5000  # 5km
    
    return api.route(from, to, 
                     profile=profile,
                     bidirectional=bidirectional)
```

### 2. é»˜è®¤é…ç½®å»ºè®®

```javascript
const DEFAULT_OPTIONS = {
  profile: 'car',
  format: 'polyline',      // èŠ‚çœå¸¦å®½
  bidirectional: true       // é»˜è®¤å¯ç”¨ï¼ˆ11x å¿«ï¼‰
};
```

### 3. ç›‘æ§å’Œä¼˜åŒ–

```bash
# è¿è¡Œ benchmark ç›‘æ§æ€§èƒ½
make benchmark

# æŸ¥çœ‹è¯¦ç»†æŠ¥å‘Š
cat BENCHMARK_RESULTS.md
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

### å­¦æœ¯è®ºæ–‡
- "Bidirectional Search That Is Guaranteed to Meet in the Middle" (Holte et al.)
- "Bidirectional Heuristic Search" (Kaindl & Kainz)

### å®ç°å‚è€ƒ
- OSRM: Contraction Hierarchies (ä¸åŒæ–¹æ³•ï¼Œä½†åŒæ ·å¿«)
- GraphHopper: Bidirectional Dijkstra/A*

---

## ğŸ”® æœªæ¥æ”¹è¿›

### è®¡åˆ’ä¸­çš„ä¼˜åŒ–

1. **å¸¦è½¬å¼¯é™åˆ¶çš„åŒå‘æœç´¢**
   - å½“å‰ä¸ºäº†æ€§èƒ½ç‰ºç‰²äº†é™åˆ¶æ£€æŸ¥
   - å¯ä»¥å®ç°æ›´æ™ºèƒ½çš„æ£€æŸ¥æœºåˆ¶

2. **ALT (A*, Landmarks, Triangle Inequality)**
   - é¢„è®¡ç®—åœ°æ ‡ç‚¹
   - æ›´å‡†ç¡®çš„å¯å‘å¼
   - è¿›ä¸€æ­¥æå‡æ€§èƒ½

3. **Contraction Hierarchies (å¯é€‰)**
   - é¢„å¤„ç†èŠ‚ç‚¹å±‚çº§
   - æŸ¥è¯¢æ—¶é—´ <1ms
   - ä½œä¸ºå¯é€‰åŠŸèƒ½

---

## âœ… æ€»ç»“

### å®ç°æˆæœ

âœ… **æ€§èƒ½æå‡**: 11.21x  
âœ… **API é›†æˆ**: `bidirectional` å‚æ•°  
âœ… **åå‘ç´¢å¼•**: ä¼˜åŒ–åå‘æœç´¢  
âœ… **åŸºå‡†æµ‹è¯•**: å®Œæ•´æ€§èƒ½æŠ¥å‘Š  

### ä½¿ç”¨å»ºè®®

- **é•¿è·ç¦»**: å¿…ç”¨åŒå‘ï¼ˆ>5kmï¼‰
- **ä¸­è·ç¦»**: æ¨èåŒå‘ï¼ˆ1-5kmï¼‰
- **çŸ­è·ç¦»**: å¯é€‰åŒå‘ï¼ˆ<1kmï¼‰
- **éœ€è¦é™åˆ¶**: ä½¿ç”¨å•å‘

### ä¸‹ä¸€æ­¥

è§ [docs/ROADMAP_PRIORITY.md](ROADMAP_PRIORITY.md) äº†è§£æœªæ¥è®¡åˆ’ã€‚

---

**åŒå‘ A* - è®©è·¯ç”±å¿« 11 å€ï¼** âš¡ğŸš€

